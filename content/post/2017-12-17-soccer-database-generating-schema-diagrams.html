---
title: 'Soccer-Database: Generating schema diagrams'
author: Knut Behrends
date: '2017-12-17'
slug: Soccerdb-schema-diagrams
css: /css/custom.css
output: 
  html_document:
    toc: true
    toc_depth: 1
    css: styles.css
    fig_caption: yes
    keep_md: no
image: /static/img/post/football--diagram-sm.png
banner: img/post/thumb/footballb--diagram-sm.png
categories:
  - blog-post
tags:
  - fun
  - R
summary: Extracting databas info from the command lines
keywords: ["Personal-Blog", "Fun", "rstats", "Sports-Data", "Soccer", "databases"]      
---

  <link rel="stylesheet" href="/css/custom.css" type="text/css" />


<div class="alert alert-info"><b>tl;dr:</b>
                This blog post shows 3 times the same database diagram, at varying levels of detail.
                </div>
<p>This is part 1 of a 3-part series of small blog posts about my first attempts at Bayesian Analysis of Soccer data. (Part 3 is not written yet).</p>
<p>In order to get started I had to invest much more effort than expected into cleaning the data and getting familiar with it.</p>
<div id="dataset" class="section level4">
<h4>Dataset</h4>
<p>The dataset used here is the <a href="https://www.kaggle.com/hugomathien/soccer/">“European Soccer Database” - 25k+ matches, players &amp; teams attributes for European Professional Football</a> from Kaggle.com. This dataset is delivered as an Sqlite database. It contains 7 tables which have been filled by the original curator by scraping numerous websites many times in 2014-2016.</p>
<p>The SQLite database in question is a file on my local hard disk.</p>
</div>
<div id="the-database-schema" class="section level4">
<h4>The database schema</h4>
<p>The database schema can be viewed with the free <a href="http://www.schemacrawler.com/how-to.html">schemacrawler</a> tool.</p>
<blockquote>
<p>Note: To get schemacrawler to work properly, <code>Java</code> and <code>Graphviz</code> need to be installed on your computer. At this time, I do not know the minimum versions required for these tools. Just use the most recent relleases. Both are free.</p>
</blockquote>
<p>A basic command to list the database contents is</p>
<pre><code># This is bash code for the unix command line
#
#  assign the absolute path to sqlite file to variable: db  
db=&quot;/home/knut/code/git/football-data-collection/football-data.sqlite&quot;
#
# the actual shell command
./schemacrawler.sh -server sqlite -database $db -password=&quot;&quot; -c list</code></pre>
<p>Output:</p>
<pre><code>System Information
========================================================================

generated by                              SchemaCrawler 14.17.04        
generated on                              2017-12-17 12:52:40           

        

Tables
========================================================================

Country                                                          [table]
League                                                           [table]
&quot;Match&quot;                                                          [table]
Player                                                           [table]
Player_Attributes                                                [table]
Team                                                             [table]
Team_Attributes                                                  [table]</code></pre>
<p>There are no views defined in the database.</p>
<p>List the table contents:</p>
<p>(This result is similar to the previous one, )</p>
<pre><code>Row Count
========================================================================

Row Count                                                               
------------------------------------------------------------------------
Country                                                          11 rows
League                                                           11 rows
&quot;Match&quot;                                                      25,979 rows
Player                                                       11,060 rows
Player_Attributes                                           183,978 rows
Team                                                            299 rows
Team_Attributes                                               1,458 rows</code></pre>
</div>
<div id="the-schema-diagram" class="section level4">
<h4>The “schema diagram”</h4>
<p>Visualize these tables in a diagram, showing the tables, rowcounts, column names, columns datatypes, and their primarykey-foreignkey relationships between the tables.</p>
<p>As explained in the <a href="http://www.schemacrawler.com/diagramming.html">schemacrawler documentation</a>, this can be done in many variants.</p>
<p>Command-line options used:</p>
<ul>
<li>To suppress schema names and foreign key names, use <code>-portablenames</code><br />
</li>
<li>Show only significant columns, such as primary and foreign key columns, and columns that are part of unique indexes: use <code>-infolevel=standard  -command=brief</code> .<br />
</li>
<li>optionally, to show column ordinals: set configuration option <code>schemacrawler.format.show_ordinal_numbers=true</code> in the configuration file <code>config/schemacrawler.config.properties</code>, as mentioned in the <a href="http://www.schemacrawler.com/diagramming.html">documentation</a></li>
</ul>
</div>
<div id="high-level-diagram" class="section level4">
<h4>High-Level Diagram</h4>
<p>This command can be used to create a PNG image file with a schema diagram.:</p>
<pre><code>./schemacrawler.sh -server sqlite -database $db  -password=&quot;&quot; \
   -infolevel=maximum -command=brief \ 
   -portablenames  -outputformat=png -outputfile=footballb--diagram--brief--no-constraintnames-colnum--rowcounts.png
</code></pre>
<p>This command yields this picture: 
{{< figure src="/img/post/footballb--diagram--brief--no-constraintnames-colnum--rowcounts.png" title="↑ High-Level Diagram ↑"  width="900" class="img-width-medium" >}}
</p>
<p>This diagram above is only high-level. A more accurate diagram would contain <em>all nonempty</em> columns in the tables and look like this:</p>
</div>
<div id="all-relevant-columns-diagram" class="section level4">
<h4>“All relevant columns” diagram</h4>

                {{<  figure src="/img/post/footballb--diagram--no-playerXY-cols--no-constraintnames-colnum--rowcounts.png" title="↑ All nonempty columns Diagram↑  " class="img-width-medium"  >}}

                
<p>The <code>Match</code> table contains a lot of columns from commercial betting companies. The 3-letter codes correspond to the odds and other bookie metadata.</p>
</div>
<div id="all-columns-diagram" class="section level4">
<h4>“All columns” Diagram</h4>
<p>The actual <code>Match</code> table contains many columns that serve no apparent purpose. There are dozens of columns that have names such as <code>homePlayerX10</code>, <code>awayPlayPlayerY2</code>…. The full diagram looks quite bizarre, and is shown here only for completeness:</p>
<pre><code>./schemacrawler.sh -server sqlite -database $db  -password=&quot;&quot; \
-infolevel=maximum -command=schema -portablenames  -outputformat=png \
-outputfile=footballb--diagram--with-playerXY-cols--no-constraintnames-colnum--rowcounts.png </code></pre>
{{< figure src="/img/post/footballb--diagram--with-playerXY-cols--no-constraintnames-colnum--rowcounts.png" title="↑ All-columns Diagram (shows even irrelevant ones) ↑" class="img-width-medium">}}

</div>
